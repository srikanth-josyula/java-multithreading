package org.sample.http;

import java.io.IOException;
import okhttp3.Call;
import okhttp3.MediaType;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.RequestBody;
import okhttp3.Response;

public class OKHttpClient {

    @SuppressWarnings("deprecation")
    public static String sendPOSTSync(String urlString, String jsonString) throws IOException {
        String result = null;
        OkHttpClient client = new OkHttpClient();

        MediaType mediaType = MediaType.parse("application/octet-stream");
        RequestBody body = RequestBody.create(mediaType, jsonString);

        Request request = new Request.Builder()
            .url(urlString)
            .post(body)
            .addHeader("Content-Type", "application/json")
            .addHeader("Authorization", "Basic a")
            .build();
        
        Call call = client.newCall(request);
        
        try (Response response = call.execute()) {
            // Check if the response is successful
            if (!response.isSuccessful()) {
                throw new IOException("Unexpected code " + response);
            }
            result = response.body().string();  // Store response body
        } catch (IOException e) {
            System.out.println("An IO Exception occurred while executing the HTTP request: " + e.getMessage());
        } catch (Exception e) {
            System.out.println("An unexpected Exception occurred while executing the HTTP request: " + e.getMessage());
        }

        return result;
    }
}
